name: PR Review Follow-ups
on:
  pull_request_review:
    types: [submitted]
permissions:
  issues: write
  pull-requests: read
jobs:
  create_followup_issues:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - uses: actions/github-script@v8
        with:
          script: |
            const review = context.payload.review;
            const pr = context.payload.pull_request;

            const followupPatterns = [
              /follow-up/i,
              /follow up/i,
              /out of scope/i,
              /todo:/i,
              /fixme:/i,
              /future work/i,
              /next iteration/i
            ];

            if (!review.body) return;

            const hasFollowup = followupPatterns.some((pattern) => pattern.test(review.body));

            if (hasFollowup) {
              const issueTitle = `Follow-up from PR #${pr.number}: ${pr.title}`;
              const issueBody = `## Context
                From PR #${pr.number} - ${pr.title}

                ## Review Comment
                ${review.body}

                ## Reviewer
                @${review.user.login}

                ## PR Link
                ${pr.html_url}
              `;

              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: issueTitle,
                body: issueBody,
                labels: ['follow-up', 'from:pr-review'],
                assignees: [pr.user.login]
              });

              console.log('Created follow-up issue for PR review');
            }
